<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>a|os Jetpack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography,aspect-ratio"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora&amp;display=swap">
    <script src="https://unpkg.com/htmx.org@1.9.2" integrity="sha384-L6OqL9pRWyyFU3+/bjdSri+iIphTN/bvYyM37tICVyOJkWZLpP2vGn6VUEXgzg6h" crossorigin="anonymous"></script>
    <style>
        .input-wrapper {
            transition: all 0.5s ease-in-out;
            min-height: 50px;
            max-height: 200px;
            overflow: auto;
        }
        body {
            font-family: 'Inconsolata', serif;
        }    
    </style> 
<body id="body" class="bg-gray-100">

    <div class="fixed left-0 top-0 p-4 flex invisible lg:visible">
        <span class="self-center text-2xl font-semibold whitespace-nowrap text-gray-500 dark:text-white">a|os</span>
        </div>

        <div class="fixed right-0 top-0 p-4 flex flex-col invisible lg:visible">
        
        <a href="?chat=main" class="py-1 px-2 mb-2 text-left whitespace-nowrap no-underline rounded-md border border-solid  bg-gray-200 hover:bg-gray-300 text-gray-600 dark:text-white">
            Main
        </a>
        
        <a href="?chat=new-chat" class="py-1 px-2 mb-2 text-left whitespace-nowrap no-underline rounded-md border border-solid border-gray-500 bg-gray-200 hover:bg-gray-300 text-gray-600 dark:text-white">
            New Chat
        </a>
         

        <button id="new-chat" type="button" class="py-1 px-2 mb-2 mt-5 inline-flex text-center items-center rounded-md border border-solid bg-gray-200 hover:bg-gray-300  text-gray-600 dark:text-white">
            <svg class="w-3 h-3 mr-2  text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 18">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 1v16M1 9h16"></path>
                </svg>
            New
        </button>
    </div>
    
    <div class="mb-20">
        <div id="messages-container" class="px-4 pt-6 pb-4 max-w-4xl mx-auto" hx-get="../../29840eda0eaa66458ae2f1ac8ab033c57c1b3d7c17b18451071d7573630176ce/query/messages" hx-trigger="load, receipt" hx-vals="js:{messagekey: getMessageFilter(event)}" hx-swap="beforeend">
        

            <div class="message flex items-start mb-4 w-full">
                <div class="avatar w-10 h-10 mr-4 mt-2 overflow-hidden">
                    
                    <svg class="w-full h-full object-cover fill-gray-300  dark:text-white" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs></defs><title>user</title><path d="M16,4a5,5,0,1,1-5,5,5,5,0,0,1,5-5m0-2a7,7,0,1,0,7,7A7,7,0,0,0,16,2Z"></path><path d="M26,30H24V25a5,5,0,0,0-5-5H13a5,5,0,0,0-5,5v5H6V25a7,7,0,0,1,7-7h6a7,7,0,0,1,7,7Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
                    
                </div>
                <div class="content w-full bg-white p-4 rounded-lg shadow-md">
                    <article class="prose" style="max-width: 95ch;">
            <p>WHAT IS THE GOAL HERE?</p>

                    </article>
                </div>
            </div>

            <div class="message flex items-start mb-4 w-full">
                <div class="avatar w-10 h-10 mr-4 mt-2 overflow-hidden">
                    
                    <svg class="w-full h-full object-cover fill-gray-300 dark:text-white" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs><style>.cls-1{fill:none;}</style></defs><title>chat-bot</title><path d="M16,19a6.9908,6.9908,0,0,1-5.833-3.1287l1.666-1.1074a5.0007,5.0007,0,0,0,8.334,0l1.666,1.1074A6.9908,6.9908,0,0,1,16,19Z"></path><path d="M20,8a2,2,0,1,0,2,2A1.9806,1.9806,0,0,0,20,8Z"></path><path d="M12,8a2,2,0,1,0,2,2A1.9806,1.9806,0,0,0,12,8Z"></path><path d="M17.7358,30,16,29l4-7h6a1.9966,1.9966,0,0,0,2-2V6a1.9966,1.9966,0,0,0-2-2H6A1.9966,1.9966,0,0,0,4,6V20a1.9966,1.9966,0,0,0,2,2h9v2H6a3.9993,3.9993,0,0,1-4-4V6A3.9988,3.9988,0,0,1,6,2H26a3.9988,3.9988,0,0,1,4,4V20a3.9993,3.9993,0,0,1-4,4H21.1646Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
                    
                </div>
                <div class="content w-full bg-white p-4 rounded-lg shadow-md">
                    <article class="prose" style="max-width: 95ch;">
            <p>The goal here is to assist you in writing Python code based on the specifications you provide. You can describe the functionality you want, and I can help generate the Python code for it. Additionally, if you need to modify or execute a function, I can assist with that as well. Please provide the details of the functionality you want in your Python code.</p>

                    </article>
                </div>
            </div>

            <div class="message flex items-start mb-4 w-full">
                <div class="avatar w-10 h-10 mr-4 mt-2 overflow-hidden">
                    
                    <svg class="w-full h-full object-cover fill-gray-300  dark:text-white" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs></defs><title>user</title><path d="M16,4a5,5,0,1,1-5,5,5,5,0,0,1,5-5m0-2a7,7,0,1,0,7,7A7,7,0,0,0,16,2Z"></path><path d="M26,30H24V25a5,5,0,0,0-5-5H13a5,5,0,0,0-5,5v5H6V25a7,7,0,0,1,7-7h6a7,7,0,0,1,7,7Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
                    
                </div>
                <div class="content w-full bg-white p-4 rounded-lg shadow-md">
                    <article class="prose" style="max-width: 95ch;">
            <p>write me a todo app that uses the local store for todos, where i can send a new todo or request the current list</p>

                    </article>
                </div>
            </div>

            <div class="message flex items-start mb-4 w-full">
                <div class="avatar w-10 h-10 mr-4 mt-2 overflow-hidden">
                    
                    <svg class="w-full h-full object-cover fill-gray-300 dark:text-white" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs><style>.cls-1{fill:none;}</style></defs><title>chat-bot</title><path d="M16,19a6.9908,6.9908,0,0,1-5.833-3.1287l1.666-1.1074a5.0007,5.0007,0,0,0,8.334,0l1.666,1.1074A6.9908,6.9908,0,0,1,16,19Z"></path><path d="M20,8a2,2,0,1,0,2,2A1.9806,1.9806,0,0,0,20,8Z"></path><path d="M12,8a2,2,0,1,0,2,2A1.9806,1.9806,0,0,0,12,8Z"></path><path d="M17.7358,30,16,29l4-7h6a1.9966,1.9966,0,0,0,2-2V6a1.9966,1.9966,0,0,0-2-2H6A1.9966,1.9966,0,0,0,4,6V20a1.9966,1.9966,0,0,0,2,2h9v2H6a3.9993,3.9993,0,0,1-4-4V6A3.9988,3.9988,0,0,1,6,2H26a3.9988,3.9988,0,0,1,4,4V20a3.9993,3.9993,0,0,1-4,4H21.1646Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
                    
                </div>
                <div class="content w-full bg-white p-4 rounded-lg shadow-md">
                    <article class="prose" style="max-width: 95ch;">
            <p>I will generate the requested functionality:</p>
            <pre><code>Write a Python application to manage a To-Do list. The application should use a local store for To-Do items. It should have functionality to add a new To-Do item and to request the current list of To-Do items.
            </code></pre>
            <p>Here are some examples for the function input:</p>
            <pre><code>['Add To-Do: Buy milk', 'Get To-Do list']
            </code></pre>

                    </article>
                </div>
            </div>

            <div class="message flex items-start mb-4 w-full">
                <div class="avatar w-10 h-10 mr-4 mt-2 overflow-hidden">
                    
                    <svg class="w-full h-full object-cover fill-gray-300  dark:text-white" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs></defs><title>user</title><path d="M16,4a5,5,0,1,1-5,5,5,5,0,0,1,5-5m0-2a7,7,0,1,0,7,7A7,7,0,0,0,16,2Z"></path><path d="M26,30H24V25a5,5,0,0,0-5-5H13a5,5,0,0,0-5,5v5H6V25a7,7,0,0,1,7-7h6a7,7,0,0,1,7,7Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
                    
                </div>
                <div class="content w-full bg-white p-4 rounded-lg shadow-md">
                    <article class="prose" style="max-width: 95ch;">
            <p>let's try again</p>

                    </article>
                </div>
            </div>

            <div class="message flex items-start mb-4 w-full">
                <div class="avatar w-10 h-10 mr-4 mt-2 overflow-hidden">
                    
                    <svg class="w-full h-full object-cover fill-gray-300 dark:text-white" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs><style>.cls-1{fill:none;}</style></defs><title>chat-bot</title><path d="M16,19a6.9908,6.9908,0,0,1-5.833-3.1287l1.666-1.1074a5.0007,5.0007,0,0,0,8.334,0l1.666,1.1074A6.9908,6.9908,0,0,1,16,19Z"></path><path d="M20,8a2,2,0,1,0,2,2A1.9806,1.9806,0,0,0,20,8Z"></path><path d="M12,8a2,2,0,1,0,2,2A1.9806,1.9806,0,0,0,12,8Z"></path><path d="M17.7358,30,16,29l4-7h6a1.9966,1.9966,0,0,0,2-2V6a1.9966,1.9966,0,0,0-2-2H6A1.9966,1.9966,0,0,0,4,6V20a1.9966,1.9966,0,0,0,2,2h9v2H6a3.9993,3.9993,0,0,1-4-4V6A3.9988,3.9988,0,0,1,6,2H26a3.9988,3.9988,0,0,1,4,4V20a3.9993,3.9993,0,0,1-4,4H21.1646Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
                    
                </div>
                <div class="content w-full bg-white p-4 rounded-lg shadow-md">
                    <article class="prose" style="max-width: 95ch;">
            <p>I will generate the requested changes:</p>
            <pre><code>Write a Python application to manage a To-Do list. The application should use a local store for To-Do items. It should have functionality to add a new To-Do item and to request the current list of To-Do items.
            </code></pre>
            <p>Here are some examples for the function input:</p>
            <pre><code>['Add To-Do: Buy milk', 'Get To-Do list']
            </code></pre>

                    </article>
                </div>
            </div>
 </div>

        <div id="loader" class="pb-4 w-full">
            <div class="w-12 h-12 mx-auto">
                <svg class="w-full h-full stroke-gray-600 dark:stroke-white" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                    <g fill="none" fill-rule="evenodd" stroke-width="3">
                        <circle cx="22" cy="22" r="1">
                            <animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate>
                            <animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate>
                        </circle>
                        <circle cx="22" cy="22" r="1">
                            <animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate>
                            <animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate>
                        </circle>
                    </g>
                </svg>
            </div>
            <div class="mt-2 mx-auto text-center text-gray-500">
                <span id="loader-text">Loading...</span>
            </div>
        </div>
    </div>

    <div class="chat-input-container fixed bottom-0 left-0 right-0 p-2 bg-gray-100 border-t border-gray-200">
        <div class="relative flex items-center max-w-4xl mx-auto pl-14">
            <div id="chat-input-wrapper" class="input-wrapper flex-1 bg-white border border-gray-300 rounded">
                <textarea id="chat-input" class="w-full p-2 pr-8 outline-none resize-none" placeholder="Type a message..."></textarea>
            </div>
            <button id="send-button" class="absolute right-4 bottom-1/2 transform translate-y-1/2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6 text-blue-600">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const agent_id = "0184431e335847e3a27f07b505ad6639b3774e24eac909c7c4c04cd30b9bc229"
        const frontend_id = "83b9172f99c794e2022484821dd793662398cfd6ea635811efde33e2df781bc3"
        const chat_actors = JSON.parse('{"main": "549266a3e1c766cd9250b6c78467ea594a8ba0cd71fbd40e5fac08aa9afc12c8", "new-chat": "29840eda0eaa66458ae2f1ac8ab033c57c1b3d7c17b18451071d7573630176ce"}')
        const chat_titles = JSON.parse('{"main": "Main", "new-chat": "New Chat"}')
        const current_chat = "new-chat"
        const current_chat_id = "29840eda0eaa66458ae2f1ac8ab033c57c1b3d7c17b18451071d7573630176ce"

        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const newChatButton = document.getElementById('new-chat');

        // Expands the textarea to fit its content
        chatInput.addEventListener('input', function() {
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Sends the message when Enter is pressed, and adds a new line when Ctrl+Enter is pressed
        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                if (!e.shiftKey) {
                    // Prevent the default "Enter" behaviour (adding a new line)
                    e.preventDefault();
                    // Send the message (you'll need to implement this function yourself)
                    sendMessage();
                }
            }
        });

        // Sends the message when the button is clicked
        sendButton.addEventListener('click', sendMessage);
        function sendMessage() {
            chat_inbox_url = "../../29840eda0eaa66458ae2f1ac8ab033c57c1b3d7c17b18451071d7573630176ce/inbox"
            const message = chatInput.value.trim();
            if (message) {
                console.log('Sending message:', message);
                // Send the message (you'll need to implement this function yourself)
                fetch(chat_inbox_url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: message
                });
                // Clear the input
                chatInput.value = '';
                chatInput.style.height = 'auto';
            }
        }

        newChatButton.addEventListener('click', newChat)
        function newChat(){
            frontend_inbox_url = "../../83b9172f99c794e2022484821dd793662398cfd6ea635811efde33e2df781bc3/inbox"
            //ask for name, then post
            const chatName = prompt("Please enter a name for the new chat", "New Chat");
            if (chatName != null) {
                console.log('Creating new chat:', chatName);
                // Send the message (you'll need to implement this function yourself)
                fetch(frontend_inbox_url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'AOS-Message-Type': 'create-chat'
                    },
                    body: JSON.stringify({'name': chatName})
                });
            }
        }

        const evtSource = new EventSource("../../../messages-sse?content=true&mt=receipt&mt=new-chat");
        evtSource.onmessage = (e) => {
            console.log('SSE Event, message:', e);
        };
        evtSource.addEventListener('receipt', (e) => {
            data = JSON.parse(e.data);
            //console.log('SSE Event, receipt:', data);
            if(data.sender_id == current_chat_id && data.content != null){
                htmx.trigger("#messages-container", "receipt", {messagekey: data.content});
            }
            else{
                //todo indicate that there are new messages in this other chat
                console.log('SSE Event: Not for current chat, ignoring');
            }
        });
        evtSource.addEventListener('new-chat', (e) => {
            data = JSON.parse(e.data);
            console.log('SSE Event, new-chat', data);
            //redirect to new chat
            window.location.href = "?chat=" + data.content;
        });

        function getMessageFilter(e){
            //if the event contain messagekey, return it
            //console.log('Getting message filter for event:', e);
            if(e.detail != null && e.detail.messagekey != null){
                return e.detail.messagekey;
            }
            return null;
        }

        htmx.on('htmx:afterSwap', function(evt) {
            window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
        });

    </script>

</body></html>